---
- name: Configure DHCP Reservation in Red Hat Satellite
  hosts: localhost
  connection: local
  gather_facts: false
  vars:
    # These will be populated by your AAP Survey
    target_mac: "{{ mac_address }}"
    target_ip: "{{ ip_address }}"
    target_hostname: "{{ vm_hostname }}"
    
    # Satellite Connection Details (Best handled via AAP Credentials)
    sat_url: "https://nuc6.aus.redhat.com"
    sat_org: "Red_Hat"
    sat_location: "Austin"
    sat_domain: "aus.redhat.com"
    sat_subnet: "Austin Subnet"

  tasks:
    - name: Create a host entry for DHCP reservation
      redhat.satellite.host:
        username: "{{ sat_username }}"
        password: "{{ sat_password }}"
        server_url: "{{ sat_url }}"
        validate_certs: false
        name: "{{ target_hostname }}.{{ sat_domain }}"
        organization: "{{ sat_org }}"
        location: "{{ sat_location }}"
        ip: "{{ target_ip }}"
        mac: "{{ target_mac }}"
        domain: "{{ sat_domain }}"
        subnet: "{{ sat_subnet }}"
        managed: true
        build: true
      delegate_to: localhost
